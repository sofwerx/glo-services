sudo: required
services:
- docker
language: bash
before_script:
- openssl aes-256-cbc -K $encrypted_43d029628f4b_key -iv $encrypted_43d029628f4b_iv -in .dm.enc -out .dm -d
- sudo apt-get -qq update
- curl -sL https://deb.nodesource.com/setup_6.x | sudo -E bash -
- sudo apt-get install -y nodejs
- sudo npm install -g @mumbacloud/dmport
- eval $(dmport --import "$(cat .dm)")
- rm -f .dm
script:
- export COMPOSE_PROJECT_NAME=glo-services
- docker-compose build -t sofwerx/glo-services:latest .
- docker-compose up -d --force-recreate glo-services
after_success:
- docker login -u="$DOCKER_USERNAME" -p="$DOCKER_PASSWORD"
- docker push sofwerx/glo-services:latest
branches:
  only:
  - master
